{"title":"Collab Slack R","markdown":{"yaml":{"title":"Collab Slack R","description":"A short description of the post.\n","author":[{"name":"Rodney Dyer","url":"https://dyerlab.org","affiliation":"Center for Environmental Studies","affiliation_url":"https://ces.vcu.edu","orcid_id":"0000-0003-4707-3453"}],"date":"2016-07-08","output":{"distill::distill_article":{"self_contained":false}}},"containsRefs":false,"markdown":"\n\n\n\n\nI just ran across an R package that allows you to integrate your R workflow into the [Slack](http://www.slack.com) environment.  Really cool.  Below I show how to set it up and to post output of your analyses to slack channels for your team as well as to register notifications.\n\n<!--more-->\n\n[<img class=\"aligncenter size-medium wp-image-1022\" src=\"wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-11.17.56-AM-300x141.png\" alt=\"Screen Shot 2016-07-08 at 11.17.56 AM\" width=\"300\" height=\"141\" srcset=\"wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-11.17.56-AM-300x141.png 300w, wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-11.17.56-AM-768x362.png 768w, wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-11.17.56-AM.png 968w\" sizes=\"(max-width: 300px) 100vw, 300px\" />](wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-11.17.56-AM.png)\n\nFirst things first, I recommend installing the latest version from the [github](https://github.com/hrbrmstr/slackr) repository.\n\n<pre class=\"lang:r decode:true\">library(devtools)\ninstall_github(\"hrbrmstr/slackr\")\n</pre>\n\nNow you have to set up a config file.  I think it looks for it in <span class=\"lang:r decode:true crayon-inline \">~/.slackr</span>  It is a normal Debian Control File (DCF) format.  Here is my example one:\n\n<pre class=\"lang:sh decode:true\">api_token: xoxp-XXXXXXXXXXX-XXXXXXXXX-XXXXXXXXXX-XXXXXXXXX\nchannel: #r\nusername: rodney\nincoming_webhook_url: https://hooks.slack.com/services/XXXXXXXX/XXXXXXXX/XXXXXXXX</pre>\n\nYou need to get the <span class=\"lang:r decode:true crayon-inline \">api_token</span>  and the <span class=\"lang:r decode:true crayon-inline \">incoming_webhook_url</span>  from slack itself.    Once you have that file saved, when you want to setup the slackr environment, you load it in and can send messages such as:\n\n<pre class=\"lang:r decode:true\">require(slackr)\nslackr_setup()\nslackr(\"This is an incoming piece of text from RStudio\")</pre>\n\nWhich results in the following in my #r slack channel:\n\n[<img class=\"aligncenter wp-image-1028 size-full\" src=\"wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.41.41-PM.png\" alt=\"Screen Shot 2016-07-08 at 1.41.41 PM\" width=\"727\" height=\"91\" srcset=\"wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.41.41-PM.png 727w, wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.41.41-PM-300x38.png 300w\" sizes=\"(max-width: 727px) 100vw, 727px\" />](wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.41.41-PM.png)\n\nThere is also a provision for sending output graphics like ggplot objects.  Here is an example of heterozygosity in the Arapat data set.\n\n<pre class=\"lang:r decode:true \">library(gstudio)\nlibrary(ggplot2)\ndata(arapat)\nhe <- genetic_diversity(arapat,mode=\"He\")\np <- ggplot( he, aes(x=Locus, y=He)) + geom_bar(stat=\"identity\") + theme_bw()\nggslack(p)\n</pre>\n\nWhich directly uploads the image to the channel as:\n\n[<img class=\"aligncenter wp-image-1029 size-full\" src=\"wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.46.04-PM.png\" alt=\"Screen Shot 2016-07-08 at 1.46.04 PM\" width=\"380\" height=\"422\" srcset=\"wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.46.04-PM.png 380w, wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.46.04-PM-270x300.png 270w\" sizes=\"(max-width: 380px) 100vw, 380px\" />](wp-content/uploads/2016/07/Screen-Shot-2016-07-08-at-1.46.04-PM.png)\n\nVery Cool!\n\n* * *\n\nThere is a slight <span style=\"color: #ff0000\">problem</span> though.  The current version of the slackr library has an error in it associated with (perhaps) a recent change in the Slack API that has not been fixed by the developer.\n\nFor me to get this to work, I had to compile the package myself after making the following change in one file.  To fix it, do the following:\n\n  1. Download (or checkout) the repository from github at: <https://github.com/hrbrmstr/slackr>\n  2. Open the project in RStudio\n  3. Open the R file names <span class=\"lang:r decode:true crayon-inline \">slackr_utils.R</span>\n  4. In the function named <span class=\"lang:r decode:true crayon-inline \">slackr_ims</span>  the last line (line 117) is something like <span class=\"lang:r decode:true crayon-inline\">dplyr::left_join( %some stuff% )</span>\n  5. Replace this line with <span class=\"lang:r decode:true crayon-inline \">suppressWarnings( merge(users, ims, by.x=&#8221;id&#8221;, by.y='user') )</span>\n  6. The compile and install the package as: <pre class=\"lang:r decode:true \">require(devtools)\nload_all()\nbuild()\ninstall()\n</pre>\n\n  7. It should work just fine.\n\nHopefully, on the next time that this package is updated by the author, the <span class=\"lang:r decode:true crayon-inline \">left_join()</span>  problem will have been resolved.  This issue had been marked as &#8220;resolved&#8221; in the github issues a while back but apparently not pushed to the repository.\n \n \n \n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":{"distill::distill_article":{"self_contained":false}},"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"output-file":"collab-slack-r.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.38","theme":"cosmo","title-block-banner":true,"title":"Collab Slack R","description":"A short description of the post.\n","author":[{"name":"Rodney Dyer","url":"https://dyerlab.org","affiliation":"Center for Environmental Studies","affiliation_url":"https://ces.vcu.edu","orcid_id":"0000-0003-4707-3453"}],"date":"2016-07-08"},"extensions":{"book":{"multiFile":true}}}}}