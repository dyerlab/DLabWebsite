{
  "hash": "339c5bb4dcce71a66ac1d5de3cd791fe",
  "result": {
    "markdown": "---\ntitle: \"Simulating Random Populations\"\ndescription: |\n  A short description of the post.\nauthor:\n  - name: Rodney Dyer\n    url: https://dyerlab.org\n    affiliation: Center for Environmental Studies\n    affiliation_url: https://ces.vcu.edu\n    orcid_id: 0000-0003-4707-3453\ndate: 2019-04-21\noutput:\n  distill::distill_article:\n    self_contained: false\n---\n\n\n\n\n\n\nThe `gstudio` package has routines that can be used to simulate random populations.  I've added these to facilitate more exploratory data analysis.  Here is how you can use them.\n\nIf you have not updated the `gstudio` and `popgraph` packages in a while, you probably should.  Here is how (if it asks if you would like to update the other packages, it is probably a good idea to say yes).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::install_github(\"dyerlab/popgraph\")\ndevtools::install_github(\"dyerlab/gstudio\")\n```\n:::\n\n\nThen load it in as:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gstudio)\n```\n:::\n\n\nI'm going to start with the enigmatic bark beetle data set.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(arapat)\nsummary(arapat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Species      Cluster      Population        ID         Latitude    \n Cape     : 75   CBP-C :150   32     : 19   101_10A:  1   Min.   :23.08  \n Mainland : 36   NBP-C : 84   75     : 11   101_1A :  1   1st Qu.:24.59  \n Peninsula:252   SBP-C : 18   Const  : 11   101_2A :  1   Median :26.25  \n                 SCBP-A: 75   12     : 10   101_3A :  1   Mean   :26.25  \n                 SON-B : 36   153    : 10   101_4A :  1   3rd Qu.:27.53  \n                              157    : 10   101_5A :  1   Max.   :29.33  \n                              (Other):292   (Other):357                  \n   Longitude          LTRS          WNT            EN           EF     \n Min.   :-114.3   01:01 :147   03:03  :108   01:01  :225   01:01 :219  \n 1st Qu.:-113.0   01:02 : 86   01:01  : 82   01:02  : 52   01:02 : 52  \n Median :-111.5   02:02 :130   01:03  : 77   02:02  : 38   02:02 : 90  \n Mean   :-111.7                02:02  : 62   03:03  : 22   NA's  :  2  \n 3rd Qu.:-110.5                03:04  :  8   01:03  :  7               \n Max.   :-109.1                (Other): 15   (Other): 16               \n                               NA's   : 11   NA's   :  3               \n     ZMP           AML           ATPS          MP20    \n 01:01 : 46   08:08  : 51   05:05  :155   05:07  : 64  \n 01:02 : 51   07:07  : 42   03:03  : 69   07:07  : 53  \n 02:02 :233   07:08  : 42   09:09  : 66   18:18  : 52  \n NA's  : 33   04:04  : 41   02:02  : 30   05:05  : 48  \n              07:09  : 22   07:09  : 14   05:06  : 22  \n              (Other):142   08:08  :  9   (Other):119  \n              NA's   : 23   (Other): 20   NA's   :  5  \n```\n:::\n:::\n\n\nTo simulate random data sets we need to start off by determining what allele frequencies you may want.  I'm going to use the stratum-level frequencies from the example data set.  Here is what these look like.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages( library(tidyverse) )\nlibrary(DT)\nfreqs <- frequencies(arapat, stratum=\"Population\")\nhead(freqs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Stratum Locus Allele Frequency\n1     101  LTRS     01 0.2777778\n2     101  LTRS     02 0.7222222\n3     101   WNT     01 1.0000000\n4     101    EN     01 0.6111111\n5     101    EN     03 0.3888889\n6     101    EF     01 0.7142857\n```\n:::\n:::\n\n\nthough the whole data set has 700 rows!\n\nWhat I'm going to do is to create a random dataset from these frequencides.  This dataset will have 20 populations (I'll just grab the first 20 `Stratum` from this frequency matrix).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfreqs %>%\n  filter( Stratum %in% unique(freqs$Stratum)[1:20] ) -> sim_freqs\nsummary(sim_freqs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Stratum             Locus              Allele            Frequency     \n Length:370         Length:370         Length:370         Min.   :0.0500  \n Class :character   Class :character   Class :character   1st Qu.:0.1500  \n Mode  :character   Mode  :character   Mode  :character   Median :0.3500  \n                                                          Mean   :0.4297  \n                                                          3rd Qu.:0.7000  \n                                                          Max.   :1.0000  \n```\n:::\n:::\n\n\n\nAnd we can take a quick look at the frequencies across populations for, say *MP20* as:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_freqs %>%\n  filter( Locus == \"MP20\", Stratum %in% unique(Stratum)[1:5] ) %>% \n  ggplot( aes(Allele,Frequency)) + \n  geom_bar( stat=\"identity\", position=\"dodge\" )  + \n  facet_grid( Stratum ~ .) + \n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](simulating-random-populations_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nOK.  Now, lets take a look at how we can make a random population.  The `make_population()` function takes a frequency matrix and creates random individuals. Here is an example.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfake101 <- make_population( sim_freqs %>% filter(Stratum==\"101\"), N=100 )\nhead(fake101)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Population ID   AML  ATPS    EF    EN  LTRS  MP20   WNT   ZMP\n1        101  1 08:08 04:09 01:01 01:03 01:02 13:13 01:01 01:01\n2        101  2 08:11 09:09 01:01 01:03 01:02 12:12 01:01 01:01\n3        101  3 08:08 02:02 01:02 01:01 01:02 13:13 01:01 01:01\n4        101  4 11:11 04:09 01:02 01:03 02:02 11:12 01:01 01:01\n5        101  5 11:11 02:04 01:02 01:03 01:02 12:12 01:01 01:01\n6        101  6 08:11 02:02 01:01 01:01 01:02 12:14 01:01 01:01\n```\n:::\n:::\n\n\n\nThe frequencies should be pretty close to the real ones.  Compare the `LTRS` locus allele frequencies from the simualted data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfrequencies( fake101,loci = \"LTRS\") \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Locus Allele Frequency\n1  LTRS     01      0.28\n2  LTRS     02      0.72\n```\n:::\n:::\n\n\nand the real data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_freqs %>% filter(Locus==\"LTRS\", Stratum==\"101\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Stratum Locus Allele Frequency\n1     101  LTRS     01 0.2777778\n2     101  LTRS     02 0.7222222\n```\n:::\n:::\n\n\nPretty close.  So using this approach, we can make all kinds of allele random populations.  You just need to figure out the allele frequency matrix and then pass that to the appropriate functions.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n \n \n",
    "supporting": [
      "simulating-random-populations_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}